# ADR-008: 有意義的故事生成規則

**日期**: 2025-06-23  
**狀態**: 已接受  
**決策者**: Human + Claude

## 背景

用戶明確指出當前自動生成的故事檔案缺乏故事意義，感覺像流水帳：

> "不覺得這幾個檔案都沒有什麼故事意義嗎？感覺像是流水帳
> 以後請只提供有故事意義的 story 不管是技術面、產品面、debug、還是流程改善
> 重點是要根據commit 的項目，以及內容去判斷
> 同一天的 commit 如果發現是相同故事，可以多個 commit 的故事寫在一起就好"

需要建立嚴格的故事價值判斷機制。

## 問題檔案範例

當前產生的無意義故事：
- `2025-06-23-core-system-enhancement-story.md`
- `2025-06-23-documentation-system-story.md`  
- `2025-06-23-file-naming-conventions-story.md`
- `2025-06-23-filename-generation-improvement-story.md`

這些檔案的問題：
- 缺乏故事性（沒有挑戰、學習、洞察）
- 只是重複描述 commit 內容
- 沒有提供額外價值或經驗分享

## 決策

### 1. 故事生成的核心原則

#### 1.1 必須有故事價值
故事必須包含以下至少一個元素：
- **技術挑戰**: 遇到困難問題並解決
- **重要洞察**: 發現了重要的開發模式或反模式  
- **流程改善**: 顯著提升了開發效率或品質
- **產品突破**: 實現了關鍵功能或用戶價值
- **除錯過程**: 有趣或複雜的 debug 經歷
- **協作經驗**: 人機協作的有價值發現

#### 1.2 禁止的無意義故事
❌ **絕對不生成的情況**：
- 單純的代碼清理或格式調整
- 常規的配置更新
- 簡單的檔案重新命名
- 例行的文檔更新
- 微小的 bug 修復（< 10 行代碼）
- 自動化工具的常規輸出

### 2. 故事生成判斷標準

#### 2.1 技術故事標準
✅ **值得記錄**：
- 解決了困擾多時的技術問題
- 實現了複雜的系統整合
- 發現了性能瓶頸並優化
- 學會了新的技術或工具
- 重構了關鍵架構組件

❌ **不值得記錄**：
- 更新依賴版本
- 修正拼字錯誤
- 調整代碼格式
- 添加簡單註解

#### 2.2 產品故事標準  
✅ **值得記錄**：
- 實現了新的用戶功能
- 顯著改善了用戶體驗
- 解決了用戶痛點
- 完成了重要的產品里程碑

❌ **不值得記錄**：
- 微調 UI 樣式
- 更新靜態文字
- 小幅調整配置

#### 2.3 流程故事標準
✅ **值得記錄**：
- 建立了新的開發工作流程
- 顯著提升了團隊效率
- 自動化了重複性工作
- 解決了協作問題

❌ **不值得記錄**：
- 更新文檔格式
- 調整檔案結構
- 例行維護工作

### 3. 故事合併規則

#### 3.1 同日故事合併
如果同一天的多個 commit 屬於同一個故事主題，合併為單一故事：

**範例情況**：
```
Commit 1: feat(auth): add user login API
Commit 2: feat(auth): add login form UI  
Commit 3: test(auth): add login integration tests
Commit 4: fix(auth): handle edge cases
```

**合併為**：`2025-06-23-user-authentication-implementation-story.md`

#### 3.2 跨日故事分離
超過一天的開發工作，即使相關也要分開記錄：
- 每個故事代表一個完整的開發週期
- 避免故事過於冗長
- 保持時間脈絡清晰

### 4. 自動化判斷機制

#### 4.1 故事價值評分
根據以下因素計算故事分數（0-100）：

**技術複雜度** (0-30分)：
- 變更檔案數量 > 10: +10分
- 涉及多個系統/模組: +10分  
- 新技術或工具使用: +10分

**業務影響** (0-30分)：
- 新功能實現: +15分
- 用戶體驗改善: +10分
- 性能優化: +5分

**開發洞察** (0-40分)：
- 解決複雜問題: +20分
- 發現重要模式: +15分
- 流程改善: +10分
- 人機協作突破: +15分

**只有分數 ≥ 60 分才生成故事**

#### 4.2 關鍵詞觸發器
包含以下關鍵詞的 commit 更可能有故事價值：
- `implement`, `refactor`, `optimize`, `solve`
- `breakthrough`, `challenge`, `discovery`
- `integration`, `architecture`, `system`
- `user`, `experience`, `feature`

#### 4.3 排除關鍵詞
包含以下關鍵詞的 commit 通常無故事價值：
- `format`, `style`, `cleanup`, `typo`
- `update`, `bump`, `merge`, `sync`
- `rename`, `move`, `delete`

### 5. 實現策略

#### 5.1 修改 post-commit-doc-gen.py
```python
def should_generate_story(self) -> bool:
    """嚴格判斷是否應該生成故事"""
    score = self._calculate_story_score()
    
    # 分數低於 60 不生成故事
    if score < 60:
        return False
    
    # 檢查是否可以與今日其他故事合併
    return self._check_story_merge_needed()

def _calculate_story_score(self) -> int:
    """計算故事價值分數"""
    # 實現評分邏輯
    pass
```

#### 5.2 故事合併邏輯
- 檢查當日已有故事
- 分析主題相關性
- 決定合併或新建

### 6. 故事模板改進

#### 6.1 有價值的故事結構
```markdown
# [故事標題]

**挑戰**: 描述遇到的具體問題或需求
**解決方案**: 說明採取的方法和技術決策  
**關鍵洞察**: 從這次經驗中學到的重要知識
**影響**: 對產品、團隊或技術的實際影響
**後續**: 這次經驗如何影響未來的開發
```

#### 6.2 避免的模板
❌ 不要使用：
```markdown
## 背景
這次提交包含了 X 個檔案的變更。

## 主要變更  
- 修改了檔案 A
- 新增了檔案 B
```

## 立即行動

### 1. 清理現有無意義故事
需要刪除的檔案：
- `2025-06-23-core-system-enhancement-story.md`
- `2025-06-23-documentation-system-story.md`
- `2025-06-23-file-naming-conventions-story.md`  
- `2025-06-23-filename-generation-improvement-story.md`

### 2. 實現新的故事生成邏輯
- 修改 `should_generate_story()` 方法
- 實現故事價值評分系統
- 加入故事合併機制

### 3. 創建有意義的合併故事
將今天的所有開發工作合併為一個有價值的故事：
`2025-06-23-ai-development-workflow-automation-story.md`

## 影響

### 正面影響
- 📚 **品質提升**: 只保留有價值的開發經驗
- 🎯 **重點明確**: 專注於真正重要的學習和洞察
- 💡 **知識沉澱**: 累積有實用價值的開發智慧
- 🚀 **效率提升**: 避免無意義的文檔維護

### 預期結果
- 故事生成頻率下降 80%
- 故事品質和實用性大幅提升
- 開發者更願意閱讀和參考故事
- 真正的經驗得到有效傳承

---

**重要**: 此規範立即生效。優先考慮故事價值而非生成數量。