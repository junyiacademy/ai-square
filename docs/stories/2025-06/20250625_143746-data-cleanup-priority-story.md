# 資料清理優先 - 修復 Archived Tickets 資料品質問題

## 📋 任務摘要
- **票券 ID**: 20250625_143746-data-cleanup-priority
- **類型**: refactor
- **狀態**: 已完成
- **時間**: 2025-06-25 14:37 - 15:08 (約 31 分鐘)

## 🎯 目標
清理 archived tickets 中的資料品質問題，確保後續分析和報告的準確性。

## 🔍 問題發現

在分析 archived tickets 時發現嚴重的資料品質問題：

1. **88% 的 tickets 有問題** (74/84)
2. **主要問題**：
   - 66 個檔案有空 sessions (最多達 73 個空 sessions!)
   - 72 個檔案 duration 計算錯誤
   - 61 個檔案 ID 為空字串
   - 檔名格式不一致
   - 缺失必要欄位

## 💻 實作方案

### 建立清理腳本
創建了 `cleanup-archived-tickets.py` 腳本，包含以下功能：

1. **檔名格式統一**
   - 將各種格式統一為 `YYYYMMDD_HHMMSS-ticket-name.yml`
   - 處理特殊格式如 `2025-06-24-23-44-59-docs-restructure.yml`

2. **移除空 sessions**
   - 過濾掉完全空的 sessions
   - 保留至少一個有意義的 session
   - 修正 placeholder 日期 (YYYY-MM-DD)

3. **修正 duration 計算**
   - 根據 started_at 和 completed_at 重新計算
   - 補充缺失的時間欄位

4. **補充缺失欄位**
   - 從檔名生成空的 ID
   - 推斷 type (feature/bug/refactor)
   - 確保 status 為 completed

5. **安全機制**
   - Dry-run 模式預覽變更
   - 自動備份原始檔案到 backup 目錄
   - 生成詳細的清理報告

## 📊 執行結果

```yaml
總檔案數: 84
處理成功: 84 (100%)
有問題檔案: 74 (88.1%)

修復的問題:
- 檔名格式: 1
- 空 sessions: 66
- duration 計算: 72
- 缺失欄位: 3
- 空 ID: 61

總共修復: 203 個問題
```

## 🔄 可重用模式

### 批次資料清理架構
```python
class DataCleaner:
    def __init__(self, source_path, backup_path, dry_run=True):
        # 初始化配置
        
    def run(self):
        # 主執行流程
        
    def process_item(self, item):
        # 處理單一項目
        
    def generate_report(self):
        # 生成報告
```

### YAML 資料驗證與修復
- 讀取 → 驗證 → 修復 → 備份 → 寫入
- 保持原始資料結構
- 使用 safe_load/dump 避免安全問題

### 智能欄位推斷
- 從檔名推斷 ID
- 從名稱推斷 type
- 從時間戳計算 duration

## 📚 學到的經驗

1. **資料品質的重要性**
   - 早期的資料問題會累積
   - 需要定期檢查和清理

2. **備份優先**
   - 永遠先備份再修改
   - 提供回滾機制

3. **漸進式處理**
   - 先 dry-run 驗證
   - 確認無誤後執行
   - 保留詳細日誌

## 🎉 成果

- ✅ 所有 archived tickets 資料品質問題已修復
- ✅ 建立了可重用的清理腳本
- ✅ 原始檔案都已安全備份
- ✅ 生成了完整的清理報告

現在可以對 archived tickets 進行準確的分析和統計了！

---
*Generated by AI Square Development Assistant*