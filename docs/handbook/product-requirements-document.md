# AI Square 產品需求文檔 (PRD)

## 1. 專案概述

### 當前狀態 (2025/08)
- ✅ **Phase 1 完成**: 專業級 CMS 系統已上線，具備 AI 輔助編輯功能
- ✅ **Phase 1.5 完成**: CMS 系統增強，現代化 UI/UX
- 🚀 **Phase 2 進行中**: SaaS 學習平台開發中，6 大核心功能已完成
- 📋 **Phase 3-4 規劃中**: Agent 系統與動態內容生成

**技術狀態更新 (2025/08/12)**：
- **測試覆蓋率**: 70.38% (Statements/Lines)
- **測試通過率**: 98.4% (3753/3785 passed)
- **TypeScript**: 生產代碼零 any 類型
- **Bundle Size**: 282KB (需優化至 <200KB)
- **Icon 庫**: 已統一為 lucide-react (節省 31MB)
- **整合測試基礎設施**: 已建立 Docker 化 + 層級化（Level-1/2）測試套件
- **健康檢查 API**: 已新增基本健康檢查端點

### 產品願景
AI Square 是一個「用 AI 學 AI 素養」的創新學習平台，基於國際 AI Literacy 框架，透過 AI 技術本身來提升學習者的 AI 素養能力。我們相信學習 AI 最好的方式就是實際使用 AI，在真實情境中培養批判性思考和負責任的 AI 使用能力。

平台核心理念：
- **Learning by Doing**：在實際使用中學習 AI
- **AI-Powered Education**：用 AI 優化學習體驗
- **Evidence-Based**：基於學術研究的 AI 素養框架
- **Personalized Journey**：個人化的學習路徑

### 核心價值主張
- **智能化學習路徑**：基於 AI 的個性化推薦
- **實時 AI 輔導**：24/7 AI 助教即時反饋
- **開放式學習**：支援標準化與開放式問答
- **多語言支持**：9 種主要語言覆蓋
- **企業級架構**：可擴展的插件化設計

## 2. 市場洞察與產品定位

### 核心痛點與解決方案
- **Onboarding 痛點**：不知道從何開始 → **智能櫃檯**：個人化引導
- **PBL 痛點**：制式課程無聊 → **客製化教室**：彈性體驗
- **Social 痛點**：線上學習孤獨 → **學習社群**：共學機制

### 產品機會
1. **社交學習功能**：影子同學、匿名進度分享、共學房間
2. **結構化 AI 培訓**：PBL 情境學習、即時回饋、個人化調整
3. **企業解決方案**：團隊追蹤、客製化內容、ROI 量化

## 3. 系統架構

### 技術棧總覽
```
┌─────────────────────────────────────────────────────────┐
│                  SaaS App Layer                          │
│         (Next.js Frontend + FastAPI Backend)             │
├─────────────────────────────────────────────────────────┤
│           MCP / Agent Layer (Phase 3+)                   │
├─────────────────────────────────────────────────────────┤
│              Content Service Layer (CMS)                 │
│                  (FastAPI + Git)                         │
├─────────────────────────────────────────────────────────┤
│               Content File Layer                         │
│              (GitHub Repository)                         │
└─────────────────────────────────────────────────────────┘
```

### 主要技術選型
- **前端**: Next.js 15, TypeScript, Tailwind CSS v4, react-i18next
- **後端**: FastAPI, Python 3.x
- **AI**: Google Vertex AI (Gemini 2.5 Flash), Claude API (翻譯), OpenAI (規劃中)
- **資料庫**: PostgreSQL (用戶資料、學習記錄)
- **儲存**: GitHub (內容版本控制), GCS (靜態檔案), Redis (分散式快取)
- **測試**: Jest (70.38% 覆蓋率), React Testing Library, Playwright (E2E)
- **狀態管理**: SWR (規劃中), Context API
- **UI 元件**: lucide-react (icons), framer-motion (動畫)

## 4. 核心功能模組

### 4.1 CMS 系統 (✅ Phase 1 完成，🚀 Phase 2 增強中)
**Phase 1 核心功能（已完成）**：
- Git-Based 內容管理與版本控制
- Monaco Editor 整合（VS Code 等級編輯體驗）
- AI 輔助編輯（補完、翻譯、改進、KSA 對應）
- 統一的儲存與 PR 創建工作流程
- 分支管理與檔案差異檢視

**Phase 2 增強功能（2025/07 新增）**：
- ✅ 完整的分支管理系統（Branch Manager）
- ✅ 現代化 UI 設計與響應式佈局
- ✅ 進階 AI 助手功能（Quick Actions）
  - KSA 能力映射自動生成
  - YAML 結構驗證與排序
  - 多語言內容翻譯（支援 zhTW）
- ✅ 即時處理動畫與 Toast 通知
- ✅ PR 工作流程自動化
- ✅ 完整測試覆蓋（UI 元件、API、服務層）

**技術架構優化**：
- FileList、FileEditor、BranchManager 元件分離
- GitHub Service 層抽象化
- Vertex AI 整合強化
- Jest 測試基礎設施完善
- Docker 部署支援

### 4.2 PBL 情境式學習系統 (🚀 開發中)
**核心概念**：
- 從做中學（Learning by Doing）
- 真實情境模擬（Real-world Scenarios）
- 過程重於結果（Process over Product）
- 多元能力整合（聽說讀寫）

**已實作功能**：
- ✅ 完整學習流程（情境選擇→任務執行→完成報告）
- ✅ Program-Tasks 架構（每個情境包含多個程序，每個程序有多個任務）
- ✅ 任務評估與即時反饋
- ✅ 個人化質性回饋生成
- ✅ 完整多語言支援

**待開發功能**：
- ❌ 語音輸入（說話模態）
- ❌ 修改歷程記錄
- ❌ 資源使用追蹤
- ❌ 更多情境內容

### 4.3 學習平台核心功能
**已實作**：
- ✅ AI 素養評估（25題測驗）
- ✅ 四大領域能力視覺化
- ✅ 學習進度追蹤
- ✅ 多語言介面（14種語言）
- ✅ Discovery 探索功能（2025/01/04 新增）
  - AI 職涯評估系統
  - 9+ 預設職涯路徑
  - 動態任務生成
  - 遊戲化學習體驗
  - AI 導師即時互動

**待開發**：
- ❌ OAuth2 社交登入
- ❌ AI 推薦課程（部分實作於 Discovery）
- ❌ 協作學習功能

### 4.4 Rubrics 專家協作系統 (📋 規劃中)
**設計理念**：
- 專家設計的評量標準
- 多維度評估框架
- 版本控制與審核流程
- AI 根據 Rubrics 自動評分

## 5. 發展路線圖

### Phase 1: CMS 基礎 (✅ 2024/11-2025/01)
- Git-based 版本控制
- AI 輔助編輯功能
- 智能工作流程
- GitHub 深度整合

### Phase 1.5: CMS 增強 (✅ 2025/06/30-07/02)
- 完整分支管理系統
- 現代化 UI/UX 重構
- AI Quick Actions 功能
- 自動化測試覆蓋
- Docker 容器化部署

### Phase 2: SaaS 平台 (🚀 2025/01-06)
**進行中**：
- PBL 情境學習系統
- 多語言本地化
- AI 輔導對話
- 學習追蹤分析

**即將開始**：
- 使用者認證系統
- 社交學習基礎
- 個人化推薦

### Phase 3: Agent 智能 (📋 2025/07-12)
- MCP 統一管理
- 動態內容生成
- 智能學習路徑
- 多 Agent 協作

### Phase 4: 完全個人化 (🔮 2026+)
- AGI 深度整合
- 虛擬學習夥伴
- 企業解決方案
- 開放生態系統

## 6. 成功指標與風險管理

### KPIs
- **用戶指標**: MAU、留存率、學習時長、完成率
- **學習成效**: 能力提升率、評估通過率、NPS
- **平台指標**: 內容創建量、AI 互動次數
- **商業指標**: 付費轉換、LTV、CAC、MRR

### 主要風險
- **技術風險**: AI 成本、擴展性、延遲問題
- **市場風險**: 競爭激烈、用戶接受度、地區差異
- **營運風險**: 內容品質、隱私合規、服務穩定性

## 7. 技術優化計畫 (2025/08 新增)

### 7.1 核心體驗修復 (Priority 1 - Week 1)

#### 修復學習進度遺失問題
- **問題**: 重整頁面會遺失所有填寫內容
- **解法**: 實作 localStorage 自動儲存機制
- **影響**: 提升用戶體驗，減少挫折感

#### 全域錯誤處理
- **問題**: API 失敗時顯示白畫面
- **解法**: 實作 Error Boundary + 友善錯誤訊息
- **影響**: 錯誤率降低 90%

#### 改善載入狀態 UX
- **問題**: 按鈕點擊後無反應
- **解法**: LoadingButton 元件 + 禁用狀態
- **影響**: 用戶明確知道操作狀態

### 7.2 效能優化 (Priority 2 - Week 1-2)

#### SWR 資料管理
- **問題**: 相同 API 重複呼叫
- **解法**: 實作 SWR 統一快取管理
- **預期**: API 呼叫減少 70%

#### 首頁 SSG 優化
- **問題**: Client-side rendering 載入慢
- **解法**: 改為 Static Generation
- **預期**: 載入速度提升 3 倍

#### 虛擬滾動實作
- **問題**: 大量 scenarios 列表效能差
- **解法**: react-window 虛擬化
- **預期**: 渲染效能提升 80%

### 7.3 用戶體驗提升 (Priority 3 - Week 2)

#### 智能 Onboarding
- **問題**: 新用戶不知道從何開始
- **解法**: 3 步驟個人化引導流程
- **預期**: 留存率提升 40%

#### 學習 Streak 系統
- **問題**: 缺乏回訪動機
- **解法**: 連續學習天數追蹤
- **預期**: DAU 提升 25%

### 7.4 架構優化建議

#### 不該做的事（Over-engineering）
- ❌ Monaco Editor 動態載入（影響 <1% 用戶）
- ❌ 全域 Redis 快取（現階段不需要；僅於 KSA API 針對性導入）
- ❌ GraphQL（過度複雜）
- ❌ 微服務架構（還沒有規模）

#### 應該專注的事
- ✅ 修復核心 Bug
- ✅ 統一資料管理 (SWR)
- ✅ 基本效能優化 (SSG)
- ✅ 用戶引導流程

## 8. 近期優先任務 (2025 Q1-Q2)

### 已完成 ✅
- 認證系統修復（登出、session、Remember Me）
- PBL 系統完善（進度儲存、草稿重用、任務摘要）
- 多語言支援（14種語言完整翻譯）
- Discovery 探索功能（2025/01/04 完成）
  - 完整的職涯探索流程
  - AI 驅動的動態內容生成
  - 遊戲化學習體驗
  - Journey 頁面整合為第 6 個功能
- 核心模組測試覆蓋（2025/07/01 更新）
  - **JWT 模組**: 100% 覆蓋率 ✅
  - **Auth Token Manager**: 97.05% 覆蓋率 ✅
  - **Cache Service**: 93.42% 覆蓋率 ✅
  - **Error Logger**: 97.05% 覆蓋率 ✅
  - **Content Service**: 100% 語句覆蓋率 ✅
  - **Error Tracker**: 93.02% 覆蓋率 ✅
  - **Performance Monitor**: 84.84% 覆蓋率 ✅
  - **API Routes**: Auth Check、PBL Scenarios 完整測試 ✅
  - **React Hooks**: useAuth、useAuthenticatedFetch、use-preload-data ✅
- TypeScript 型別安全強化（2025/07/02 更新）
  - **消除所有生產代碼的 any 類型**: 從 102 個減少到 0 個 ✅
  - **PBL 完成頁面型別重構**: 完整型別定義 ✅
  - **API 路由型別強化**: 精確型別定義 ✅
- 安全性更新
  - **Next.js 升級到 14.2.30**: 修復關鍵漏洞 ✅
- 元件測試完善
  - **新增多個元件測試**: QuestionReview、ErrorDashboard、ClientLayout ✅
  - **LoginForm 和 I18nProvider 單元測試**: 完整覆蓋 ✅
- CMS 系統增強（2025/07/01-02 更新）
  - **UI/UX 現代化重構**: 響應式設計、動畫效果 ✅
  - **分支管理系統**: 完整 Git 工作流程整合 ✅
  - **AI Quick Actions**: KSA 映射、YAML 驗證、多語言翻譯 ✅
  - **測試覆蓋**: UI 元件、API 路由、服務層完整測試 ✅
  - **PR 自動化**: 自動創建 PR、分支切換 ✅

### 進行中 🟡
- 內容驗證系統（YAML schema、自動化測試）
- 基礎設施優化（錯誤追蹤、簡易記錄器）
- 測試覆蓋率提升（已達 80%+，持續優化中）

### 必要基礎建設 🚨 (高優先級)
1. **用戶數據持久化**
   - 從 localStorage 遷移到 Google Cloud Storage
   - 實作統一的數據同步機制
   - 用戶進度備份與恢復

2. **OAuth2 社交登入**
   - Google 登入整合
   - GitHub 登入整合（開發者社群）
   - 統一的用戶身份管理

3. **AI 資源管理系統**
   - Token 使用追蹤與計費
   - 用戶配額管理
   - 成本優化策略
   - 使用報表與分析

4. **監控與觀測性**
   - 錯誤追蹤系統（Sentry）
   - 性能監控（Web Vitals）
   - 用戶行為分析（GA4/Mixpanel）
   - AI 使用分析儀表板

5. **安全性強化**
   - API Rate Limiting
   - DDoS 防護
   - 資料加密（傳輸與儲存）
   - 隱私合規（GDPR/CCPA）

### 待辦 📋
- ~~效能優化~~ → 已規劃詳細執行計畫（見 7.2）
- PBL 修改歷程記錄（展示思考過程）
- 協作學習功能（共學房間、影子同學）
- 企業版功能（團隊管理、進度追蹤）

### 技術債務 (2025/08/10 更新)
- **已解決**: 
  - ✅ TypeScript 型別安全（生產代碼零 any）
  - ✅ Icon 庫重複（統一為 lucide-react）
- **高優先**: 
  - 認證狀態管理（需要統一處理）
  - 測試覆蓋率（70.38% → 目標 85%）
- **中優先**: 
  - 元件結構優化
  - API 客戶端統一
  - 環境變數管理

## 9. 效能監控與成功指標

### 技術指標 (2025/08 基準)
| 指標 | 當前值 | 目標值 | 優先級 |
|------|--------|--------|--------|
| 測試覆蓋率 | 70.38% | 85% | 高 |
| 測試通過率 | 98.4% | 100% | 高 |
| Bundle Size | 282KB | <200KB | 中 |
| API 響應時間 | ~500ms | <200ms | 高 |
| 首頁載入時間 | 3.5s | <1.5s | 高 |
| TypeScript 錯誤 | 11 (測試) | 0 | 中 |

### 業務指標
| 指標 | 當前值 | Q1 目標 | Q2 目標 |
|------|--------|---------|---------|
| 新用戶完成率 | ~20% | 40% | 60% |
| 7 天留存率 | ~15% | 30% | 45% |
| DAU/MAU | ~10% | 20% | 30% |
| 平均 Session | 5min | 10min | 15min |

### 預期成果 (執行優化計畫後)
- **技術面**: API 呼叫 -70%, 載入速度 +200%, 錯誤率 -90%
- **業務面**: 留存率 +40%, 完成率 +30%, DAU +25%

## 10. 結論

AI Square 定位為下一代 AI 素養學習平台，通過整合最新 AI 技術和教育理念，為全球用戶提供革命性的學習體驗。

**2025 Q1 關鍵焦點**：
1. **修復核心體驗問題** - 減少用戶挫折感
2. **實作基礎優化** - 不過度工程化
3. **提升用戶留存** - 智能引導 + Streak 系統

我們採用漸進式開發策略，專注於真實用戶需求，避免過早優化，從穩固的基礎逐步構建完整的學習生態系統。

---

*文檔版本: 4.0（技術優化計畫 + 效能指標更新）*  
*更新日期: 2025-08-12*  
*下次審查: 2025-09-01*