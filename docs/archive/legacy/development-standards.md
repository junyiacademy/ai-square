# AI Square 開發標準和規則

## 🎯 核心開發原則

### 完整開發定義 (Definition of Done)

**每一個開發任務必須同時完成以下所有項目，才能進入提交階段**：

```
✅ 一個完整的開發 = 文件 + 功能 + 測試 + 日誌 + 通過驗證
```

### 🔄 TDD 測試驅動開發流程

#### 1. 開發前 (Planning Phase)
- [ ] **BDD 分析**: 用戶故事、驗收標準、行為場景
- [ ] **DDD 設計**: 界限上下文、領域模型、聚合設計
- [ ] **TDD 計劃**: 測試策略、測試案例設計

#### 2. 開發中 (Implementation Phase)
- [ ] **🔴 紅燈**: 先寫失敗的測試
- [ ] **🟢 綠燈**: 實作最小功能讓測試通過
- [ ] **🔵 重構**: 優化代碼品質和結構
- [ ] **📚 文檔**: 同步更新 API 文檔和使用指南

#### 3. 開發後 (Validation Phase)
- [ ] **單元測試**: 95% 以上覆蓋率
- [ ] **整合測試**: 關鍵流程 100% 覆蓋
- [ ] **E2E 測試**: 主要用戶路徑完整測試
- [ ] **建置驗證**: ESLint + TypeScript + Build 通過
- [ ] **多語言測試**: 所有支援語言功能正常
- [ ] **響應式測試**: 桌面和手機版本驗證

## 📋 提交前檢查清單 (Pre-Commit Checklist)

### 功能完整性檢查
```bash
✅ 功能實作完成且符合驗收標準
✅ API 端點正常運作
✅ 前端組件互動正確
✅ 錯誤處理機制完善
✅ 多語言支援完整
✅ 響應式設計適配
```

### 測試覆蓋率檢查
```bash
✅ 單元測試覆蓋率 ≥ 95%
✅ 整合測試涵蓋主要流程
✅ E2E 測試驗證完整用戶路徑
✅ 所有測試通過 (綠燈狀態)
✅ 無測試警告或錯誤
```

### 代碼品質檢查
```bash
✅ ESLint 檢查通過
✅ TypeScript 編譯無錯誤
✅ 建置流程成功
✅ 無 console.log 或 debug 代碼
✅ 代碼符合專案風格規範
```

### 文檔完整性檢查
```bash
✅ API 文檔更新完整
✅ 開發歷程記錄建立
✅ README 相關章節更新
✅ CHANGELOG 自動更新
✅ 代碼審查檢查清單填寫
```

## 🚫 禁止的提交行為

### ❌ 不完整的提交
- 功能未完成就提交
- 測試覆蓋率不足就提交
- 建置失敗或有錯誤就提交
- 缺少文檔更新就提交

### ❌ 技術債務
- 留下 TODO 或 FIXME 註解
- 硬編碼字串 (應使用 i18n)
- 未處理的錯誤情況
- 效能問題或記憶體洩漏

## 🛠️ 自動化工具整合

### commit-guide 自動檢查
```javascript
// 更新後的檢查項目
const validationChecks = {
  buildSuccess: true,        // 建置成功
  lintPassed: true,         // ESLint 通過
  typeCheckPassed: true,    // TypeScript 通過
  testsPassed: true,        // 所有測試通過
  coverageThreshold: 95,    // 測試覆蓋率閾值
  documentationUpdated: true, // 文檔已更新
  e2eTestsPassed: true      // E2E 測試通過
}
```

### 測試指令標準化
```json
{
  "scripts": {
    "test": "jest",
    "test:coverage": "jest --coverage",
    "test:e2e": "playwright test", 
    "test:all": "npm run test:coverage && npm run test:e2e",
    "quality-check": "npm run lint && npm run type-check && npm run test:all"
  }
}
```

## 📊 品質指標 (Quality Metrics)

### 必達指標
- **測試覆蓋率**: ≥ 95%
- **建置成功率**: 100%
- **ESLint 通過率**: 100%
- **TypeScript 零錯誤**: 100%

### 追蹤指標  
- **開發速度**: 功能點/小時
- **缺陷率**: bugs/KLOC
- **重構頻率**: 重構次數/功能
- **文檔完整度**: 文檔覆蓋率

## 🎯 Epic 開發標準

### 一個 Epic 的完整交付包含
1. **產品文檔**: 用戶故事、驗收標準、功能規格
2. **架構設計**: 系統設計、API 規格、資料模型
3. **功能實作**: 前端組件、後端 API、資料庫結構
4. **完整測試**: 單元/整合/E2E 三層測試覆蓋
5. **品質驗證**: 代碼審查、效能測試、安全檢查
6. **部署準備**: 環境配置、部署腳本、監控設置
7. **使用文檔**: API 文檔、使用指南、故障排除

### Epic 驗收標準
```gherkin
Given 一個 Epic 開發完成
When 執行完整驗收檢查
Then 所有功能應該按規格運作
And 所有測試應該通過
And 所有文檔應該完整更新
And 代碼品質應該符合標準
And 部署應該成功無錯誤
```

## 🔄 需求變更管理

### 變更流程
當需求發生變更或擴展時，必須遵循以下步驟：

#### 1. 📋 變更記錄
- 在當前工作日誌中創建新條目 (`docs/current/work-YYYY-MM-DD.md`)
- 明確記錄變更原因、範圍、影響分析
- 標注變更類型：功能擴展、修正、重構

#### 2. 📝 Epic 更新  
- 更新相關 Epic 文件 (`docs/product/epics/`)
- 在 "需求變更記錄" 部分添加變更詳情
- 更新功能指標和實作任務狀態

#### 3. 📊 CHANGELOG 維護
- 在 `CHANGELOG.md` 的 [Unreleased] 部分記錄變更
- 依照 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) 格式
- 分類：Added/Changed/Fixed/Removed

#### 4. 🧪 測試標準不變
- 變更的代碼仍須遵循 TDD 原則
- 測試覆蓋率不得降低
- 所有測試必須通過才能提交

### 變更影響評估

#### 技術影響
- [ ] 是否影響現有 API？
- [ ] 是否需要資料庫變更？  
- [ ] 是否影響其他組件？
- [ ] 是否需要新增依賴？

#### 產品影響
- [ ] 是否改變用戶體驗？
- [ ] 是否影響效能？
- [ ] 是否需要用戶教育？
- [ ] 是否需要更新文檔？

### 變更類型定義

| 類型 | 描述 | 文檔要求 | 測試要求 |
|------|------|----------|----------|
| **功能擴展** | 新增功能到現有模組 | Epic 更新 + 工作日誌 | 新增測試案例 |
| **功能修正** | 修復現有功能問題 | 工作日誌 + CHANGELOG | 修正測試案例 |
| **重構改善** | 改善代碼結構不改功能 | 工作日誌 | 維持現有測試 |
| **架構變更** | 重大架構調整 | 完整文檔更新 | 全面測試更新 |

### 範例：Header 組件需求變更 (2024-06-21)
```markdown
## 需求變更：Header 登入狀態顯示

### 變更觸發
原始需求：Email 登入功能
變更需求：全域顯示登入狀態

### 影響評估  
- ✅ 技術：新增組件，無 API 變更
- ✅ 產品：提升 UX，無學習成本
- ✅ 測試：新增 19 個測試案例
- ✅ 文檔：Epic 更新，CHANGELOG 記錄

### 驗收結果
- Header 組件 92.1% 測試覆蓋率
- 所有 41 個測試通過
- 響應式設計驗證完成
```

## 🔄 持續改進機制

### 每次提交後
- 自動運行 CI/CD 流水線
- 生成測試覆蓋率報告
- 更新開發歷程記錄
- 分析開發效率指標

### 每週回顧
- 檢視開發速度趨勢
- 識別常見問題模式
- 優化開發流程工具
- 更新最佳實踐指南

---

> **核心理念**: 品質不是事後檢查出來的，而是在開發過程中建構出來的。每一行代碼都應該有對應的測試，每一個功能都應該有完整的文檔。