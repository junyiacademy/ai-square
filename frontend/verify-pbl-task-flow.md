# PBL Task-Based Sessions åŠŸèƒ½é©—è­‰å ±å‘Š

## ğŸ” æ¸¬è©¦ç›®æ¨™
é©—è­‰ PBL ç³»çµ±æ˜¯å¦æ­£ç¢ºå¯¦æ–½äº† task-based sessionsï¼Œç¢ºä¿ï¼š
1. æ¯å€‹ task æœ‰ç¨ç«‹çš„ session å’Œ log
2. Learn éç¨‹ä¸­è³‡æ–™æ­£ç¢ºä¿å­˜
3. Complete é é¢æ­£ç¢ºé¡¯ç¤ºè³‡æ–™
4. History é é¢ä»¥ task card å½¢å¼é¡¯ç¤º

## âœ… å·²å¯¦æ–½çš„æ”¹å‹•

### 1. **æ•¸æ“šçµæ§‹æ›´æ–°** 
- `SessionData` æ–°å¢æ¬„ä½ï¼š
  ```typescript
  currentStageId?: string;
  currentStageTitle?: string;
  currentTaskId?: string;
  currentTaskTitle?: string;
  ```

- `PBLLogData` æ–°å¢çµæ§‹åŒ–ä¿¡æ¯ï¼š
  ```typescript
  scenario_info?: { id, title, title_zh }
  stage_info?: { id, index, title, title_zh }
  task_info?: { id, index, title, title_zh }
  ```

### 2. **Session å‰µå»ºé‚è¼¯**
- å‰µå»º session æ™‚åŒ…å«å®Œæ•´çš„ scenario/stage/task ä¿¡æ¯
- Log æ–‡ä»¶åæ ¼å¼ï¼š`pbl_{scenarioId}_stage_{stageId}_task_{taskId}_{timestamp}_{random}`

### 3. **Task åˆ‡æ›é‚è¼¯**
```javascript
// handleNextTask å‡½æ•¸ç¾åœ¨æœƒï¼š
1. å®Œæˆç•¶å‰ task çš„ session
2. æ¸…ç©º session ç‹€æ…‹
3. è¨­ç½®ä¸‹ä¸€å€‹ task
4. æ–° session åœ¨ç”¨æˆ¶ç™¼é€ç¬¬ä¸€æ¢æ¶ˆæ¯æ™‚å‰µå»º
```

### 4. **History API æ”¹é€²**
- æ”¯æŒå¤šèªè¨€æ¨™é¡Œé¡¯ç¤º
- è™•ç†ç©º stages æ•¸æ“šçš„é˜²ç¦¦æ€§ç·¨ç¨‹
- å¾ stageProgress æ¨æ–·å¯¦éš›éšæ®µæ•¸

## ğŸ“Š é æœŸè¡Œç‚º

### Learn é é¢æµç¨‹ï¼š
1. **Task 1-1 é–‹å§‹**
   - ç”¨æˆ¶ç™¼é€ç¬¬ä¸€æ¢æ¶ˆæ¯ â†’ å‰µå»º Session A
   - æ‰€æœ‰å°è©±ä¿å­˜åœ¨ Session A
   - åˆ†æçµæœä¿å­˜åœ¨ Session A

2. **åˆ‡æ›åˆ° Task 1-2**
   - é»æ“Šã€Œä¸‹ä¸€å€‹ä»»å‹™ã€â†’ Session A æ¨™è¨˜ç‚ºå®Œæˆ
   - æ¸…ç©ºå°è©±è¨˜éŒ„
   - ç”¨æˆ¶ç™¼é€ç¬¬ä¸€æ¢æ¶ˆæ¯ â†’ å‰µå»ºæ–°çš„ Session B

3. **å®Œæˆ Stage 1**
   - æ‰€æœ‰ tasks å®Œæˆå¾Œé€²å…¥ä¸‹ä¸€å€‹ stage
   - æ¯å€‹ task éƒ½æœ‰ç¨ç«‹çš„è¨˜éŒ„

### History é é¢é¡¯ç¤ºï¼š
- æ¯å€‹ task ä¸€å¼µå¡ç‰‡
- é¡¯ç¤ºæ ¼å¼ï¼š`[Scenario Title] - [Stage Title] - [Task Title]`
- åŒ…å«ç¨ç«‹çš„è©•åˆ†å’Œäº’å‹•æ¬¡æ•¸

### Complete é é¢ï¼š
- é¡¯ç¤ºç‰¹å®š task çš„å®Œæˆè³‡æ–™
- åŒ…å«è©² task çš„å°è©±è¨˜éŒ„å’Œè©•ä¼°çµæœ

## ğŸ§ª æ‰‹å‹•æ¸¬è©¦æ­¥é©Ÿ

1. **æ¸…ç©ºæ¸¬è©¦æ•¸æ“š**
   - å·²åˆªé™¤ GCS ä¸­çš„æ‰€æœ‰ PBL logs

2. **æ¸¬è©¦æ–°çš„ task æµç¨‹**
   ```
   a. è¨ªå• /pbl â†’ é¸æ“‡ã€ŒAI è¼”åŠ©æ±‚è·è¨“ç·´ã€
   b. é–‹å§‹å­¸ç¿’ â†’ ç™¼é€æ¶ˆæ¯ï¼ˆå‰µå»º Task 1-1 sessionï¼‰
   c. åˆ†æä»»å‹™ â†’ æŸ¥çœ‹è©•åˆ†
   d. ä¸‹ä¸€å€‹ä»»å‹™ â†’ ç™¼é€æ¶ˆæ¯ï¼ˆå‰µå»º Task 1-2 sessionï¼‰
   e. è¿”å›æ­·å²é é¢ â†’ æ‡‰è©²çœ‹åˆ° 2 å€‹ç¨ç«‹çš„ task å¡ç‰‡
   ```

3. **é©—è­‰æ•¸æ“šéš”é›¢**
   - Task 1-1 çš„å°è©±ä¸æ‡‰å‡ºç¾åœ¨ Task 1-2 ä¸­
   - æ¯å€‹ task æœ‰ç¨ç«‹çš„ session ID

## âš ï¸ æ³¨æ„äº‹é …

1. **ç™»å…¥ç‹€æ…‹**ï¼šéœ€è¦ç¢ºä¿ç”¨æˆ¶å·²ç™»å…¥ï¼ˆä½¿ç”¨ cookie æˆ– localStorageï¼‰
2. **èªè¨€è¨­ç½®**ï¼šHistory API æœƒæ ¹æ“š `lang` åƒæ•¸è¿”å›å°æ‡‰èªè¨€çš„æ¨™é¡Œ
3. **èˆŠæ•¸æ“šå…¼å®¹**ï¼šç³»çµ±æœƒè™•ç†èˆŠçš„ stage-based sessionsï¼Œä½†æ–°å‰µå»ºçš„éƒ½æ˜¯ task-based

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè­°

1. **æ”¹é€² Complete é é¢**
   - åªé¡¯ç¤ºç‰¹å®š task çš„æ•¸æ“š
   - æ·»åŠ  task å°èˆªåŠŸèƒ½

2. **å„ªåŒ– History é¡¯ç¤º**
   - æŒ‰ scenario åˆ†çµ„é¡¯ç¤º tasks
   - æ·»åŠ ç¯©é¸åŠŸèƒ½ï¼ˆby scenario, stage, statusï¼‰

3. **å¢å¼·åˆ†æåŠŸèƒ½**
   - Task-level çš„è©³ç´°åˆ†æå ±å‘Š
   - è·¨ task çš„é€²åº¦æ¯”è¼ƒ